{{ define "main" }}

<section class="section">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-9 offset-lg-1">
        <h1 class="mb-4">{{.Title | markdownify}}</h1>
        <!-- Add the search input field here -->
        <input type="text" id="faq-search" class="form-control mb-4" placeholder="Search FAQs">
        <div class="content">
          {{.Content}}
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Add FAQ schema structured data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {{ $faqs := .Scratch.Set "faqs" slice }}
    {{ range $index, $element := findRE "<div class=\"faq-item\">([\\s\\S]*?)</div>" .Content }}
      {{ $question := index (findRE "<span class=\"faq-question\"><strong>(.*?)</strong></span>" $element 1) 0 | replaceRE "<span class=\"faq-question\"><strong>(.*?)</strong></span>" "$1" }}
      {{ $answer := replaceRE "<span class=\"faq-question\"><strong>.*?</strong></span><br>" "" $element | replaceRE "<div class=\"faq-item\">" "" | replaceRE "</div>" "" | strings.TrimSpace }}
      {{ $.Scratch.Add "faqs" (dict "question" $question "answer" $answer) }}
    {{ end }}
    {{ $faqs := $.Scratch.Get "faqs" }}
    {{ range $index, $faq := $faqs }}
      {
        "@type": "Question",
        "name": {{ $faq.question | jsonify }},
        "acceptedAnswer": {
          "@type": "Answer",
          "text": {{ $faq.answer | jsonify }}
        }
      }{{ if ne (add $index 1) (len $faqs) }},{{ end }}
    {{ end }}
  ]
}
</script>

<!-- Add the search functionality JavaScript code -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('faq-search');

    searchInput.addEventListener('input', function(event) {
      const searchTerm = event.target.value.toLowerCase();
      const faqItems = document.querySelectorAll('.faq-item');

      faqItems.forEach(function(faqItem) {
        const itemText = faqItem.textContent.toLowerCase();
        if (itemText.includes(searchTerm)) {
          faqItem.style.display = 'block';
        } else {
          faqItem.style.display = 'none';
        }
      });
    });
  });
</script>

{{ end }}
